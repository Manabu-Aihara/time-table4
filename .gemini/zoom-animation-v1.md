# タイムラインのズームアニメーション機能

## 1. 要件定義

### 1.1. 背景・目的

各所属のメンバーのタスクやイベントを効率的・視覚的に充実させるため、タイムラインのズームアニメーション機能を追加します。これにより、ユーザーは表示粒度を自由に調整し、過密なスケジュールでも個々のイベントを明確に確認できるようになります。

### 1.2. 機能概要

タイムラインの表示範囲を、専用のUI（ズームイン・アウトボタン、またはスライダー）を介して直感的に拡大・縮小できるズーム機能を提供します。

### 1.3. 機能要件

#### 1.3.1. ズーム操作

- **ズームイン:** UIコントロール（例：「+」ボタン）を操作することで、タイムラインの表示を段階的に拡大する。
- **ズームアウト:** UIコントロール（例：「-」ボタン）を操作することで、タイムラインの表示を段階的に縮小する。
- **（オプション）ズームスライダー:** スライダーをドラッグすることで、ズームレベルを連続的に変更できる。

#### 1.3.2. ズームレベルの制御

- ズームレベルの最小値と最大値を設定し、過度なズームイン・ズームアウトを防ぐ。
- ズームレベルは複数の段階（例：1時間、6時間、12時間、24時間表示など）で管理する。

#### 1.3.3. ズーム時の中心位置

- ズームの中心は、常に現在のタイムライン表示範囲の中央とする。

#### 1.3.4. パフォーマンス

- ズーム操作は、スムーズで応答性が高いこと。
- 大量のデータを表示している場合でも、パフォーマンスが低下しないように配慮する。

#### 1.3.5. ズームアニメーション

- ズームイン・ズームアウト時に、表示範囲が滑らかに変化するアニメーションを適用する。
- アニメーションの速度やイージングは、ユーザーが心地よく感じられるように調整する。

### 1.4. 非機能要件

- **ユーザビリティ:** ズーム操作は、直感的で分かりやすいこと。
- **互換性:** 主要なブラウザ（Chrome, Firefox, Safari, Edge）で正常に動作すること。
- **拡張性:** 将来的に関連機能を追加しやすいように設計する。
- **テスト:** 機能に関する単体テスト、結合テストを実装する。
- **ドキュメント:** 仕様、設計、実装に関するドキュメントを整備する。

## 2. 機能設計

### 2.1. 前提

- React(Vite), TypeScriptを使用。
- "react-calendar-timeline-v3" ライブラリのTimelineコンポーネントを既に使用している。

### 2.2. アーキテクチャ

1.  **ズームコントロールコンポーネント:**
    - ズームイン・アウトボタン、および（オプションで）ズームスライダーを持つUIコンポーネントを新規に作成します。
    - このコンポーネントは、現在のズームレベルと、ズームレベルを変更するためのコールバック関数をpropsとして受け取ります。

2.  **状態管理:**
    - 現在のタイムラインの表示範囲 (`visibleTimeStart`, `visibleTimeEnd`) と、現在のズームレベルを管理する状態を `TimelineComponent` またはその親コンポーネントで保持します。
    - Reactの `useState` または `useReducer` を利用します。

3.  **ズームロジック:**
    - ズームコントロールコンポーネントからのイベントを受け取り、次の `visibleTimeStart` と `visibleTimeEnd` を計算するロジックを `src/lib/timelineZoomUtils.ts` にヘルパー関数として実装します。
    - この関数は、現在の表示範囲とズーム方向（イン/アウト）または新しいズームレベルを引数に取り、新しい表示範囲を返します。計算の中心は常に現在の表示範囲の中央とします。

### 2.3. 実装詳細

- **対象コンポーネント:** `/home/nabu_dvl/workspace/time-table4/src/components/pages/TimelineComponent.tsx`
- **ライブラリの活用:**
    - `react-calendar-timeline-v3` の `Timeline` コンポーネントが受け取る `visibleTimeStart` および `visibleTimeEnd` プロパティを動的に変更することで、タイムラインの表示範囲を制御し、ズームを実現します。
    - アニメーションは、`visibleTimeStart` と `visibleTimeEnd` の変更を滑らかに行うことで実現します。React Springのようなライブラリの利用も検討しますが、まずはCSSトランジションでの実現可能性を探ります。

- **ファイル構成案:**
    - `src/components/molecules/TimelineZoomControl.tsx`: ズームUIコンポーネント
    - `src/hooks/useTimelineZoom.ts`: ズームの状態とロジックを管理するカスタムフック
    - `src/lib/timelineZoomUtils.ts`: ズームレベルに応じた表示期間を計算するユーティリティ関数
    - `src/tests/timelineZoomUtils.spec.ts`: 上記ユーティリティのテスト

## 3. 開発タスク

**重要**: 進行に応じて、細分化または下記のタスクを変更する

- [ - ] ズームロジックのヘルパー関数を実装 (`src/lib/timelineZoomUtils.ts`)
- [ - ] ヘルパー関数の単体テストを実装 (`src/tests/timelineZoomUtils.spec.ts`)
- [ ] ズームの状態とロジックを管理するカスタムフックを実装 (`src/hooks/useTimelineZoom.ts`)
- [ ] ズームコントロールUIコンポーネントを実装 (`src/components/molecules/TimelineZoomControl.tsx`)
- [ ] Storybookでズームコントロールコンポーネントを開発・検証 (`src/stories/TimelineZoomControl.stories.tsx`)
- [ ] `TimelineComponent` にカスタムフックとUIコンポーネントを統合し、ズーム機能を完成させる

## 4. テスト計画

1.  **単体テスト:** `timelineZoomUtils.ts` の計算ロジックが正しいことを確認します。
2.  **コンポーネントテスト (Storybook):** `TimelineZoomControl.tsx` が正しく表示され、インタラクションが機能することを確認します。
3.  **結合テスト/E2Eテスト:** 実際に `TimelineComponent` と連携させ、ズームイン・ズームアウト操作が期待通りにタイムラインの表示を更新することをブラウザ上で確認します。